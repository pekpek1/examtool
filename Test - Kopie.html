<!DOCTYPE html>
<html>
<head>
  <title>Exam Generation Tool</title>
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap');
    body {
  font-family: montserrat, arial, sans-serif;
  padding: 20px;
  background-color: #f4f4f4;
  color: #333;
}

form {
  max-width: 850px;
  margin: auto;
  background-color: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  position: relative;
}

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  background-color: #fff;
  padding: 10px;
}

label, input, select, button {
  margin-bottom: 15px;
  transition: all 0.3s ease; /* Übergangseffekte */
}

.question-block {
  border: 1px solid #ccc;
  padding: 15px;
  margin-bottom: 20px;
}

.correct-text {
  font-size: 12px;
  margin-left: 3px;
}

input[type="checkbox"] {
  margin-left: 8px;
}

label[for^='answer'] {
  margin-right: 8px;
  font-size: 14px;
}

label[for^='question'] {
  display: block;
  margin-bottom: 5px;
  font-size: 16px;
  font-weight: bold;
}

label[for='docNumber'] {
  display: block;
  font-size: 18px;
  font-weight: bold;
  white-space: nowrap;
}

label[for='title'] {
  display: block;
  font-size: 18px;
  font-weight: bold;
}

input[type="text"], textarea {
  width: 40%;
  min-height: 20px;
  height: auto;
  resize: none;
  overflow: hidden;
  font-size: 14px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#docNumber {
  width: 140px;
  margin-bottom: -10px;
  border: 1px solid #ccc;
}

#title {
  width: 350px;
  min-height: 60px;
  height: auto;
  margin-bottom: 15px;
  border: 1px solid #ccc;
}

input[id^='question'] {
  width: 48%;
  resize: none;
  overflow: hidden;
}

textarea.auto-expand {
  font-family: Arial, sans-serif;
  padding: 3px;
  min-height: 20px;
  box-sizing: border-box;
}

label[for^='answer'],
textarea.auto-expand,
.correct-text {
  vertical-align: middle;
}

.question-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.export-buttons {
  display: grid;
  height: 150px;
  grid-template-columns: repeat(2, 1fr);
  align-items:start;
  margin-top: 20px;
  margin-left: 6vw;
}

.export-buttons input,
.export-buttons button {
  margin-bottom: 1px;
  background-color: #f4f4f4;
  border: 1px solid #ccc;
  padding: 10px;
  text-align: center;
  width: 120px;
  box-sizing: border-box;
}

#exportId {
  font-size: 12px;
  background-color: #fff;
  border: 1px solid #ccc;
  padding: 10px;
}

#exportPDF {
  margin-right: 30px;
}

button:hover {
  background-color: #ddd;
  cursor: pointer;
}

input:focus, textarea:focus {
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0,123,255,.5);
}

button:active {
  background-color: #ccc;
  box-shadow: inset 0 0 5px #000;
}

::placeholder {
  color: #ccc;
  font-style: italic;
}

button, input, textarea {
  border-radius: 4px;
}
.expandable-content {
  overflow: hidden;
  transition: max-height 0.5s ease-out;
}
label[for^='points'] {
  margin-left: 135px;
}

input[id^='points'] {
  width: 30px !important;
  text-align: center;
}
input[id^='deleteQuestionNumbers'] {
  width: 50px;
}
#resetForm {
  float: right;
}
#Revnumber, #deleteQuestionNumbers, #points {
  border: 1px solid #ccc;
}

#Revnumber:focus #deleteQuestionNumbers, #points {
  border-color: #007bff;
  box-shadow: 0 0 5px rgba(0,123,255,.5);
}
  </style>
</head>
<body>
  <form id='examForm'>
    <div class="header">
      <h1>Exam Generation Tool</h1>
      <img src="https://www.wuxibiologics.com/wp-content/themes/Divi-child/ens/images/logo.svg" alt="WuXi Biologics Logo" style="width: 200px;">
    </div>
    <div style="margin-top: 80px; display: flex; justify-content: flex-start;">
      <div>
        <label for='docNumber'>Dokumentnummer/Document number:</label>
        <input type='text' id='docNumber' name='docNumber' placeholder='WX-SOP/TRA-00000'>
        <input type='text' id='Revnumber' name='Revnumber' placeholder='00' style="width: 30px; text-align: center;" maxlength="2"><br><br>
        <label for='title'>Titel/Title:</label>
        <textarea rows=1 class="auto-expand not-general-field" id='title' name='title' placeholder='Deutsch/English'></textarea><br><br>
      </div>
      <div class="export-buttons">
        <div class="button-container">
          <button type="button" id='exportPDF'>Export PDF</button>
        </div>
        <div class="button-container">
          <button type="button" id='exportTXT'>Export TXT</button>
        </div>
        <div class="button-container">
          <button type="button" id='autoPoints'>Auto Punkte<br>Auto Points</button>
        </div>
        <div class="button-container">
          <input type='text' id='exportId' placeholder='WX-EXAM-00000'>
        </div>
      </div>
    </div>
    <div id='questionsContainer'>
    </div>
    <button type='button' onclick='addQuestion()'>Frage hinzufügen/Add Question</button>
    <button type='button' id='deleteQuestion'>Frage löschen/Delete Question</button>
    <input type='text' id='deleteQuestionNumbers' placeholder='2,4,5'>
    <button type='button' id='resetForm'>Reset</button>
  </form>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
</body>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
      for (let i = 1; i <= 5; i++) {
        addQuestion();
      }
      updateMaxHeight();
    });

    let questionCount = 0;
    let answerCount = 1;
    function showOptions(id) {
  const type = document.getElementById('type' + id).value;
  const optionsDiv = document.getElementById('options' + id);
  optionsDiv.innerHTML = '';
  if (type === 'true_false') {
    optionsDiv.innerHTML = '<select><option value="true">Wahr/True</option><option value="false">Falsch/False</option></select>';
  } else if (type === 'multiple_choice') {
    optionsDiv.innerHTML = '<div id="answers' + id + '" data-answer-count="1"><label for="answerA_de">A:</label><textarea rows=1 class="auto-expand" id="answerA_de" placeholder="Deutsch"></textarea><textarea rows=1 class="auto-expand" id="answerA_en" placeholder="English"></textarea><input type="checkbox" class="correct-checkbox"><span class="correct-text">Richtig?/Correct?</span></div><br><button type="button" onclick="addAnswer(' + id + ')">Antwort hinzufügen/Add Answer</button>';
  }
  updateMaxHeight();
}
function addQuestion() {
  questionCount++;
  let defaultPoints = questionCount <= 5 ? '20' : '';
  if (questionCount === 6) {
  clearPointsFields();
}
  const currentQuestionCount = questionCount;
  const questionBlock = document.createElement('div');
  questionBlock.className = 'question-block';
  questionBlock.id = 'questionBlock' + currentQuestionCount;
  questionBlock.innerHTML = `
    <div class="question-header">
      <label for='question${currentQuestionCount}_de'>Frage/Question ${currentQuestionCount}:</label>
      <button class="expand-button">↓</button>
    </div>
    <div class="expandable-content" style="max-height: 1000px;"> 
      <textarea rows=1 class="auto-expand" id='question${currentQuestionCount}_de' name='question${currentQuestionCount}_de' placeholder='Deutsch'></textarea>
      <textarea rows=1 class="auto-expand" id='question${currentQuestionCount}_en' name='question${currentQuestionCount}_en' placeholder='Englisch'></textarea>
      <br><br>
      <label for='type${currentQuestionCount}'>Typ/Type:</label>
      <select id='type${currentQuestionCount}' name='type${currentQuestionCount}' onchange='showOptions(${currentQuestionCount})'>
      <option value=''>---</option>
      <option value='true_false'>True/False</option>
      <option value='multiple_choice'>Multiple Choice</option>
</select>
<label for='points${currentQuestionCount}'>Punkte/Points:</label>
<input type='text' id='points${currentQuestionCount}' name='points${currentQuestionCount}' value='${defaultPoints}' maxlength='2' style='border: 1px solid gray; outline: none;'>
      <div id='options${currentQuestionCount}'></div>
    </div>`;
  document.getElementById('questionsContainer').appendChild(questionBlock);
  questionBlock.querySelectorAll('.auto-expand').forEach(adjustHeight);

  const newButton = questionBlock.querySelector('.expand-button');
  newButton.addEventListener('click', function(event) {
    toggleExpand(currentQuestionCount, event);
  });
  updateMaxHeight();
}
function toggleExpand(id, event) {
  event.stopPropagation();
  event.preventDefault();
  const button = document.querySelector(`#questionBlock${id} .expand-button`);
  const content = document.querySelector(`#questionBlock${id} .expandable-content`);

  if (content.style.maxHeight === "0px" || !content.style.maxHeight) {
    content.style.maxHeight = content.scrollHeight + "px";
    button.textContent = "↓"; 
  } else {
    content.style.maxHeight = "0px";
    button.textContent = "↑";  
  }
  updateMaxHeight();
}
    function addAnswer(id) {
  const answersDiv = document.getElementById('answers' + id);
  let answerCount = parseInt(answersDiv.getAttribute('data-answer-count'), 10);
  answerCount++;
  answersDiv.setAttribute('data-answer-count', answerCount);

  const answerDiv = document.createElement('div');
  answerDiv.innerHTML = `<label for='answer${String.fromCharCode(64 + answerCount)}_de'>${String.fromCharCode(64 + answerCount)}:</label><textarea rows=1 class="auto-expand" id='answer${String.fromCharCode(64 + answerCount)}_de' placeholder='Deutsch'></textarea><textarea rows=1 class="auto-expand" id='answer${String.fromCharCode(64 + answerCount)}_en' placeholder='English'></textarea><input type='checkbox' class='correct-checkbox'><span class='correct-text'>Richtig?/Correct?</span>`;
  answersDiv.appendChild(answerDiv);
  updateMaxHeight();
}
   function adjustHeight(textarea) {
  textarea.style.height = 'auto';
  const newHeight = textarea.scrollHeight;

  const parentDiv = textarea.closest('.expandable-content');
  if (parentDiv) {
    const textareas = parentDiv.querySelectorAll('.auto-expand');
    let maxHeight = newHeight;

    textareas.forEach(siblingTextarea => {
      if (siblingTextarea !== textarea && siblingTextarea.parentElement === textarea.parentElement) {
        siblingTextarea.style.height = 'auto';
        const siblingNewHeight = siblingTextarea.scrollHeight;
        maxHeight = Math.max(maxHeight, siblingNewHeight);
      }
    });

    textareas.forEach(siblingTextarea => {
      if (siblingTextarea.parentElement === textarea.parentElement) {
        siblingTextarea.style.height = maxHeight + 'px';
      }
    });
  }
  updateMaxHeight();
}
document.addEventListener('input', function(e) {
  if (e.target && e.target.classList.contains('auto-expand')) {
    adjustHeight(e.target);
  }
});

document.querySelectorAll('.auto-expand').forEach(adjustHeight);

function updateMaxHeight() {
  const expandableContents = document.querySelectorAll('.expandable-content');
  expandableContents.forEach(content => {
    if (content.style.maxHeight !== "0px") {
      content.style.maxHeight = content.scrollHeight + "px";
    }
  });
}
function validateForm() {
  let errorMessages = [];

  const docNumber = document.getElementById('docNumber').value.trim();
  const title = document.getElementById('title').value.trim();

  if (docNumber === '') {
    errorMessages.push('Dokumentnummer fehlt.\nDocument number missing.');
  }

  if (title === '') {
    errorMessages.push('Titel fehlt.\nTitle missing.');
  }
const textareas = document.querySelectorAll('textarea:not(.not-general-field)');
for (const textarea of textareas) {
  if (textarea.value.trim() === '') {
    errorMessages.push('Nicht alle Fragen/Antworten ausgefüllt.\nNot all Questions/Answers filled out.');
    break;
  }
}
let totalPoints = 0;
  const pointsFields = document.querySelectorAll("input[id^='points']");
  pointsFields.forEach(field => {
    totalPoints += parseInt(field.value, 10) || 0;
  });

  if (totalPoints > 100) {
    errorMessages.push('Die Gesamtpunktzahl aller Fragen darf nicht mehr als 100 betragen.\nThe total points of all questions should not exceed 100.');
  }

  if (totalPoints < 100) {
    errorMessages.push('Die Gesamtpunktzahl aller Fragen muss mindestens 100 betragen.\nThe total points of all questions should be at least 100.');
  }
  const typeFields = document.querySelectorAll("select[id^='type']");
  for (const typeField of typeFields) {
    if (typeField.value.trim() === '') {
      errorMessages.push('Nicht alle Frage-Typen ausgewählt.\nNot all Question Types selected.');
      break;
    }
  }
  return errorMessages;
}
function validateFormForTxtExport() {
  let generalErrors = validateForm();
  let errorMessages = [];

  const exportId = document.getElementById('exportId').value.trim();
  if (exportId === '') {
    errorMessages.push('Exam-Nummer fehlt.\nExam number missing.');
  }

  errorMessages = errorMessages.concat(generalErrors);

  if (errorMessages.length > 0) {
    alert(errorMessages.join('\n\n'));
    return false;
  }

  return true;
}

document.getElementById('exportPDF').addEventListener('click', function() {
  const errors = validateForm();
  if (errors.length === 0) {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    
    // Dokumentnummer und Titel hinzufügen
    const docNumber = document.getElementById('docNumber').value;
    const title = document.getElementById('title').value;
    pdf.text(`Dokumentnummer: ${docNumber}`, 10, 10);
    pdf.text(`Titel: ${title}`, 10, 20);

    // Weitere Inhalte hier hinzufügen...

    // PDF speichern
    pdf.save("Beispiel.pdf");
  } else {
    alert(errors.join('\n\n'));
  }
});

document.getElementById('exportTXT').addEventListener('click', function() {
  if (validateFormForTxtExport()) {
    // Führen Sie hier den Export als TXT durch
  }
});
document.getElementById('resetForm').addEventListener('click', function() {
  const userConfirmed = confirm('Durch diese Aktion werden alle Ihre Eingaben unwiderruflich gelöscht. Möchten Sie fortfahren?\n\nThis action will irreversibly erase all your inputs. Do you wish to proceed?');
  
  if (userConfirmed) {
    document.getElementById('examForm').reset();
    
    const pointsFields = document.querySelectorAll("input[id^='points']");
    pointsFields.forEach(field => {
      field.value = '';
    });
    const typeFields = document.querySelectorAll("select[id^='type']");
    typeFields.forEach((field, index) => {
      field.value = '';
      showOptions(index + 1);
    });
  }
});
document.getElementById('deleteQuestion').addEventListener('click', function() {
  const inputField = document.getElementById('deleteQuestionNumbers');
  const questionNumbers = inputField.value.split(',').map(Number).filter(num => !isNaN(num));
  
  if (inputField.value.trim() === '') {
    alert('Bitte tragen Sie die zu löschenden Fragen ein.\nPlease enter the questions to delete.');
    return;
  }

  if (questionNumbers.length === 0 || questionNumbers.some(num => num > questionCount || num <= 0)) {
    alert('Bitte prüfen Sie Ihre Eingabe.\nPlease check your input.');
    return;
  }

  if (questionCount - questionNumbers.length < 5) {
    alert('Es müssen mindestens 5 Fragen vorhanden sein.\nThere must be at least 5 questions.');
    return;
  }
  
  const userConfirmed = confirm(`Frage(n) ${questionNumbers.join(', ')} werden unwiderruflich gelöscht. Möchten Sie fortfahren?\n\nQuestions ${questionNumbers.join(', ')} will be irreversibly deleted. Do you wish to proceed?`);
  
  if (userConfirmed) {
    let deletedCount = 0;
    questionNumbers.forEach(num => {
      const questionBlock = document.getElementById('questionBlock' + num);
      if (questionBlock) {
        questionBlock.remove();
        deletedCount++;
      }
    });
    
    questionCount -= deletedCount;
    
    if (questionCount <= 5) {
      restoreDefaultPoints();
    }
    
    let newCount = 1;
    document.querySelectorAll('.question-block').forEach((block, index) => {
      const label = block.querySelector("label[for^='question']");
      label.textContent = `Frage/Question ${newCount}:`;
      label.htmlFor = `question${newCount}_de`;
      block.id = `questionBlock${newCount}`;
      newCount++;
    });
    document.getElementById('deleteQuestionNumbers').value = '';
  }
});
function clearPointsFields() {
  const pointsFields = document.querySelectorAll("input[id^='points']");
  pointsFields.forEach(field => {
    field.value = '';
  });
}

function restoreDefaultPoints() {
  const pointsFields = document.querySelectorAll("input[id^='points']");
  pointsFields.forEach(field => {
    field.value = '20';
  });
}
document.getElementById('autoPoints').addEventListener('click', function() {
  autoFillPoints();
});

function autoFillPoints() {
  const pointsFields = Array.from(document.querySelectorAll("input[id^='points']"));
  let remainingPoints = 100;
  let values = [];

  values = getValuesForQuestions(pointsFields.length);

  values = shuffleArray(values);

  fillFields(pointsFields, values);
}

function fillFields(fields, values) {
  for (let i = 0; i < values.length; i++) {
    fields[i].value = values[i];
  }
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function getValuesForQuestions(numberOfQuestions) {
  let values = [];
  if (numberOfQuestions <= 5) {
    values = Array(5).fill(20);
  } else if (numberOfQuestions >= 6 && numberOfQuestions <= 10) {
    values = Array(10 - numberOfQuestions).fill(20).concat(Array(2 * numberOfQuestions - 10).fill(10));
  } else if (numberOfQuestions >= 11 && numberOfQuestions <= 20) {
    values = Array(20 - numberOfQuestions).fill(10).concat(Array(2 * numberOfQuestions - 20).fill(5));
  }
  return values;
}
</script>
</body>
</html>